<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Piano Timer ‚Äì Plan A+ (Voice Hardened, Drift Locked)</title>
<style>
  :root { --bg:#0f1115; --card:#151922; --text:#e6e6e6; --muted:#a0a6b0; --accent:#4aa3ff; --green:#6cffb7; --danger:#ff6b6b; }
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:760px;margin:24px auto;padding:0 16px 56px}
  h1{font-size:22px;margin:8px 0 12px}
  .card{background:var(--card);border:1px solid #222632;border-radius:16px;padding:16px;box-shadow:0 8px 32px rgba(0,0,0,.32)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{padding:12px 14px;border-radius:12px;border:1px solid transparent;font-weight:800;cursor:pointer}
  .primary{background:var(--accent);color:#00111f}
  .secondary{background:#273145;color:var(--text);border-color:#38445c}
  .success{background:var(--green);color:#002b1b}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid #2a3346;font-size:12px}
  .idle{background:rgba(255,107,107,.15);color:var(--danger)}
  .run{background:rgba(108,255,183,.15);color:var(--green)}
  .pause{background:rgba(74,163,255,.15);color:var(--accent)}
  .center{display:flex;align-items:center;justify-content:center;text-align:center}
  .totalTimer{font-variant-numeric:tabular-nums;font-weight:900;font-size:64px;line-height:1;margin:6px 0 10px;color:var(--green)}
  .label{color:var(--muted);font-size:12px}
  .value{font-variant-numeric:tabular-nums;font-weight:900;font-size:22px}
  .stat{background:#10141b;border:1px solid #1f2531;border-radius:12px;padding:12px}
  .grid{display:grid;gap:10px}
  .two{grid-template-columns:repeat(2,minmax(0,1fr))}
  canvas{width:100%;height:90px;background:#0b0e13;border:1px solid #1a2130;border-radius:10px}
  .slider{width:100%}
  .small{color:var(--muted);font-size:12px}
  .diag{color:var(--muted);font-size:12px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>üéπ Piano Timer</h1>
  <div class="card grid">
    <div class="row">
      <button id="btnEnable" class="btn primary">Enable Mic</button>
      <button id="btnDisable" class="btn secondary" disabled>Disable Mic</button>
      <button id="btnAuto" class="btn success">Auto: ON</button>
      <button id="btnManualStart" class="btn secondary">‚ñ∂ Manual Start</button>
      <button id="btnManualPause" class="btn secondary">‚è∏ Manual Pause</button>
      <span id="badge" class="pill idle">IDLE</span>
    </div>

    <div class="center">
      <div>
        <div class="label">Total (since open)</div>
        <div id="total" class="totalTimer">00:00:00</div>
      </div>
    </div>

    <div class="grid two">
      <div class="stat"><div class="label">Frame level (wide band dB)</div><div id="frameDb" class="value">‚Äì‚àû</div></div>
      <div class="stat"><div class="label">Noise floor (wide dB)</div><div id="noiseDb" class="value">‚Äì60.0</div></div>
    </div>

    <div class="grid two">
      <div class="stat"><div class="label">Piano band (C3‚ÄìC5) dB</div><div id="pianoDb" class="value">‚Äì‚àû</div></div>
      <div class="stat"><div class="label">Piano noise floor (dB)</div><div id="pianoNoiseDb" class="value">‚Äì60.0</div></div>
    </div>

    <div class="grid two">
      <div class="stat"><div class="label">Piano SNR (dB)</div><div id="pianoSnr" class="value">0.0</div></div>
      <div class="stat"><div class="label">Detector status</div><div id="detStatus" class="value">idle</div></div>
    </div>

    <div>
      <canvas id="meter"></canvas>
      <div class="small">Plan A+ hardened: stricter voice rejection, formant veto, drift lock baseline.</div>
      <div class="diag" id="pitchDiag">f0: ‚Äî Hz (‚Äî), cents: ‚Äî, H/N: ‚Äî, sfm: ‚Äî, voice: ‚Äî</div>
    </div>

    <details>
      <summary>Advanced detection settings</summary>
      <div class="grid">
        <label>Start SNR threshold (dB): <span id="snrStartLbl">12</span>
          <input id="snrStart" class="slider" type="range" min="3" max="20" step="1" value="12">
        </label>
        <label>Stop SNR threshold (dB): <span id="snrStopLbl">10</span>
          <input id="snrStop" class="slider" type="range" min="0" max="18" step="1" value="10">
        </label>
        <label>Silence to pause (seconds): <span id="silenceLbl">10</span>
          <input id="silence" class="slider" type="range" min="3" max="30" step="1" value="10">
        </label>
      </div>
    </details>
  </div>
</div>

<script>
// Full detection logic with Plan A+ improvements would be here
</script>
</body>
</html>
